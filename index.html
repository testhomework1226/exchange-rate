function fetchRatesToSheet() {
  const url = "https://open.er-api.com/v6/latest/USD";  // åŒ¯ç‡ API
  const response = UrlFetchApp.fetch(url);
  const text = response.getContentText();

  Logger.log("ğŸ“¦ API å›å‚³å…§å®¹å‰100å­—: " + text.substring(0, 100));

  let data;
  try {
    data = JSON.parse(text);
  } catch (e) {
    Logger.log("âš ï¸ JSON è§£æéŒ¯èª¤ï¼š" + e);
    return;
  }

  if (!data || !data.rates) {
    Logger.log("âš ï¸ æ‰¾ä¸åˆ° data.ratesï¼");
    return;
  }

  const sheetName = "åŒ¯ç‡è³‡æ–™";
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  let sheet = ss.getSheetByName(sheetName);
  if (!sheet) sheet = ss.insertSheet(sheetName);
  sheet.clear();

  const rates = data.rates;
  const rows = [];

  for (const [currency, rate] of Object.entries(rates)) {
    if (currency && rate) rows.push([currency, rate]);
  }

  if (rows.length === 0) {
    Logger.log("âš ï¸ æ²’æœ‰åŒ¯ç‡è³‡æ–™å¯å¯«å…¥ã€‚");
    return;
  }

  // ä¸€æ¬¡æ€§å¯«å…¥è³‡æ–™
  sheet.getRange(1, 1, 1, 2).setValues([["æ—¥æœŸ", new Date()]]);
  sheet.getRange(2, 1, 1, 2).setValues([["åŸºæº–è²¨å¹£", data.base_code]]);
  sheet.getRange(4, 1, 1, 2).setValues([["è²¨å¹£ä»£ç¢¼", "åŒ¯ç‡"]]);
  sheet.getRange(5, 1, rows.length, 2).setValues(rows);

  Logger.log("âœ… åŒ¯ç‡è³‡æ–™æ›´æ–°å®Œæˆï¼Œå…± " + rows.length + " ç­†ã€‚");
}
